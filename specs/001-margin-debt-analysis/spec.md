# 融资余额市场分析系统规格

**功能分支**: `001-margin-debt-analysis`
**创建日期**: 2025-11-08
**状态**: 草稿
**输入**: 用户描述: "通过以往的金融数据的分析功能和可视化，识别市场风险信号和投资机会"

## 用户场景与测试 *(必填)*

### 用户故事 1 - 查看核心杠杆指标仪表板 (优先级: P1)

作为金融分析师，我需要查看市场杠杆率、货币供应比率和利率成本分析的核心指标，特别是**脆弱性指数（杠杆Z分数-VIX Z分数）**，以便快速评估当前市场风险水平和潜在投资机会。

**为什么这是最高优先级**: 脆弱性指数是最核心的市场风险信号，综合反映杠杆水平和市场恐慌情绪，是所有后续分析的基础。用户需要首先了解当前市场的脆弱性状况。

**独立测试**: 用户可以访问系统并立即看到所有6个核心杠杆指标的可视化图表，包括当前值和历史趋势。无需额外操作即可获得核心价值。

**验收场景**:

1. **Given** 用户打开系统首页, **When** 页面加载完成, **Then** 显示Part1的3个指标（市场杠杆率、货币供应比率、利率成本分析）和Part2的3个指标（杠杆变化率、投资者净资产、脆弱性指数）

2. **Given** 用户查看任一指标, **When** 点击指标卡片, **Then** 显示该指标的详细历史数据图表，包含数据来源标注和时间范围选择器

3. **Given** 用户查看市场杠杆率指标, **When** 系统加载数据, **Then** 显示Margin Debt与S&P 500总市值的比率，并标注当前值和历史百分位数

---

### 用户故事 2 - 历史危机时期对比分析 (优先级: P2)

作为风险经理，我需要对比不同历史危机时期（互联网泡沫、2008金融危机、2020疫情）的市场表现，以便识别危机前的预警信号和应对策略。

**为什么这是中等优先级**: 危机时期分析为风险管理提供重要参考，但用户可以先使用基础指标分析。

**独立测试**: 用户可以选择预设的历史危机时期，系统显示该时期的所有6个核心指标，并与当前指标进行对比分析。

**验收场景**:

1. **Given** 用户在指标页面, **When** 点击"历史危机"选项卡, **Then** 显示三个预设时期选择器：互联网泡沫(2000-2002)、金融危机(2007-2009)、疫情冲击(2020-2022)

2. **Given** 用户选择"2008金融危机"时期, **When** 页面更新, **Then** 所有6个指标图表显示该时期的数据高亮，并标注与当前值的差异百分比

3. **Given** 用户选择多个危机时期, **When** 查看图表, **Then** 系统以不同颜色显示各时期数据，并在图例中标注各时期的特征

---

### 用户故事 3 - 交互式数据筛选与投资洞察 (优先级: P3)

作为投资者，我需要通过交互式筛选和数据洞察功能，识别特定时间段内的投资机会和风险信号，以便制定投资决策。

**为什么这是较低优先级**: 这是增值功能，用户可以在基础分析基础上进行更深入的研究。

**独立测试**: 用户可以设置自定义时间范围，查看筛选后的数据洞察，包括基于量化模型的投资建议和风险预警。

**验收场景**:

1. **Given** 用户在任一指标页面, **When** 调整时间范围选择器, **Then** 所有相关图表和数据洞察即时更新，显示选定时间范围内的分析结果

2. **Given** 用户查看交互式可视化, **When** 鼠标悬停在图表上, **Then** 显示该时间点的具体数值、Z分数和与历史数据的对比

3. **Given** 系统完成数据加载, **When** 用户查看投资洞察面板, **Then** 显示基于量化分析的市场风险信号（低/中/高/极高）和相应的投资建议

## 边缘案例

- 当外部数据源（FINRA、FRED、Yahoo Finance、CBOE）暂时不可用时，系统必须显示数据获取状态和最后更新时间，并提供缓存数据的降级展示
- 当用户选择的时间范围超出数据可用范围时，系统必须明确标注数据边界并提供可选的时间范围建议
- 当计算的指标值出现异常波动（如超过3个标准差）时，系统必须在图表上以不同颜色标记并提供详细说明
- 当VIX数据在1990年之前不可用时，系统必须处理数据缺失并在脆弱性指数计算中明确说明
- 当用户同时查看多个时期的数据时，系统必须保持所有图表的同步交互和状态一致

## 需求 *(必填)*

### 功能性需求

- **FR-001**: 系统必须支持从FINRA获取融资余额统计数据，包括月度数据和历史数据，特殊处理要求见澄清记录
- **FR-002**: 系统必须支持从FRED获取利率数据（联邦基金利率、10年期国债收益率）和M2货币供应量数据
- **FR-003**: 系统必须支持从Yahoo Finance获取S&P 500指数、黄金价格和BTC价格数据
- **FR-004**: 系统必须支持从CBOE获取VIX波动率指数数据（1990年至今）
- **FR-005**: 系统必须计算并展示Part1指标（1997-01至2025-09，数据覆盖率≥95%）：市场杠杆率（Margin Debt / S&P 500总市值）、货币供应比率（Margin Debt / M2）、利率成本分析（Margin Debt vs 利率关系）
- **FR-006**: 系统必须计算并展示Part2指标（2010-02至2025-09，数据覆盖率≥95%）：杠杆变化率（Margin Debt年同比变化率YoY%）、投资者净资产（现金余额-借方余额-市场缓冲垫）、**脆弱性指数（杠杆Z分数-VIX Z分数，最核心指标）**
- **FR-007**: 系统必须提供多图表展示功能，支持所有6个核心指标的同时可视化
- **FR-008**: 系统必须预设三个历史危机时期：互联网泡沫(2000-2002)、金融危机(2007-2009)、疫情冲击联合高通胀(2020-2022)
- **FR-009**: 系统必须提供交互式可视化功能，支持时间范围选择和数据筛选
- **FR-010**: 系统必须支持Plotly动态图表，包括缩放、平移和数据点悬停显示
- **FR-011**: 系统必须提供基于量化分析的市场风险信号识别（低/中/高/极高风险等级）
- **FR-012**: 系统必须提供投资机会识别功能，基于历史回测和统计验证
- **FR-013**: 所有图表必须清晰标注数据来源、时间范围和计算方法
- **FR-014**: 系统必须处理数据缺失和异常值，并提供透明的处理说明
- **FR-015**: 系统必须为所有分析结果提供免责声明：不构成投资建议

### 关键实体

- **融资余额 (Margin Debt)**: 来自FINRA的月度统计数据，代表投资者通过保证金借贷持有的股票价值
- **市场指标数据**: 来自多个数据源的金融市场数据，包括S&P 500指数、利率、M2货币供应量、VIX指数
- **杠杆比率**: 衍生计算指标，包括市场杠杆率、货币供应比率、利率成本分析等
- **变化率指标**: 时间序列分析指标，包括年同比变化率、Z分数计算、投资者净资产等
- **脆弱性指数**: **最核心指标**，计算公式为杠杆Z分数减VIX Z分数，反映市场杠杆水平与恐慌情绪的差值
- **风险信号**: 基于量化模型的风险评估输出，包括风险等级、置信区间、预警信息
- **历史时期数据**: 预设的特殊市场时期标签和数据，用于对比分析和危机模式识别
- **可视化配置**: 图表显示参数、时间范围设置、交互选项等

## 成功标准 *(必填)*

### 可衡量成果

- **SC-001**: 用户在首次访问后30秒内能够看到所有6个核心指标的可视化展示，无需额外操作
- **SC-002**: Part1指标数据覆盖率≥95%（1997-01至2025-09），Part2指标数据覆盖率≥95%（2010-02至2025-09）
- **SC-003**: 交互式图表响应时间小于2秒，支持实时缩放、平移和数据点悬停
- **SC-004**: 脆弱性指数作为最核心指标，必须清晰展示杠杆Z分数与VIX Z分数的差值计算及历史趋势
- **SC-005**: 数据源集成成功率保持在95%以上，能够自动重试失败的API调用并提供状态反馈
- **SC-006**: 投资洞察面板提供的数据必须包含置信度指标，置信度超过80%的建议才显示
- **SC-007**: 历史危机时期对比功能必须支持至少3个时期的同时对比，每个时期包含所有6个核心指标
- **SC-008**: 用户完成时间范围自定义和数据筛选操作的平均时间不超过5秒
- **SC-009**: 系统必须在所有分析结果页面显著位置显示免责声明，说明分析结果不构成投资建议

## 澄清记录

### 2025-11-08

- **Q: 核心指标优先级** → A: 脆弱性指数（杠杆Z分数 - VIX Z分数）作为最核心指标，需要重点展示和详细说明
- **Q: FINRA数据源处理** → A: FINRA融资余额统计数据需要特殊处理，用户将提供已有的数据源实现方案
- **Q: Part1数据时间范围** → A: 1997-01至2025-09，要求95%以上数据覆盖率，如无法达到可适当缩短
- **Q: Part2数据时间范围** → A: 2010-02至2025-09，要求95%以上数据覆盖率
