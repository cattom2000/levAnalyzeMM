# æ—¥æœŸèŒƒå›´UIäº¤äº’é—®é¢˜åˆ†ææŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

**é—®é¢˜æè¿°**: åœ¨Streamlitåº”ç”¨çš„å·¦ä¾§è¾¹æ "System Configuration" â†’ "Display Options"ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©æ—¥æœŸèŒƒå›´ï¼Œä½†é‡æ–°é€‰æ‹©åï¼ŒVulnerability Index Trendã€Market Leverage Ratioã€Money Supply Ratioä¸‰ä¸ªå›¾è¡¨ä¸ä¼šç›¸åº”æ›´æ–°ï¼Œä»æ˜¾ç¤ºç›¸åŒçš„å›ºå®šæ—¥æœŸèŒƒå›´æ•°æ®ã€‚

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### 1. ä»£ç å±‚é¢åˆ†æ

#### é—®é¢˜ä½ç½®
**æ–‡ä»¶**: `src/app.py`
**å…³é”®ä»£ç æ®µ**:
- **ä¾§è¾¹æ æ§ä»¶å®šä¹‰** (ç¬¬114-127è¡Œ)
- **æ•°æ®ç”Ÿæˆé€»è¾‘** (ç¬¬183-201è¡Œ)
- **å›¾è¡¨æ¸²æŸ“é€»è¾‘** (ç¬¬204-291è¡Œ)

#### è¯¦ç»†ä»£ç å¯¹æ¯”

**ä¾§è¾¹æ  - Display Options** (ç¬¬114-127è¡Œ) âœ…
```python
st.markdown("### ğŸ“ˆ Display Options")

# ç”¨æˆ·å¯ä»¥è°ƒæ•´è¿™ä¸ªæ§ä»¶
date_range = st.date_input(
    "Select Date Range",
    value=(datetime(2020, 1, 1), datetime.now()),
    min_value=datetime(1997, 1, 1),
    max_value=datetime.now()
)

chart_type = st.selectbox(
    "Chart Type",
    ["Line Chart", "Candlestick", "Area Chart", "Bar Chart"]
)

show_annotations = st.checkbox("Show Annotations", value=True)
```

**å›¾è¡¨æ•°æ®ç”Ÿæˆ** (ç¬¬183-201è¡Œ) âŒ **é—®é¢˜æ‰€åœ¨**
```python
# Main Chart
st.subheader("ğŸ“Š Vulnerability Index Trend")

# Generate sample data for demonstration
# âš ï¸ ç¡¬ç¼–ç æ—¥æœŸèŒƒå›´ - æœªä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„date_rangeï¼
dates = pd.date_range(start='2020-01-01', end='2025-11-12', freq='M')
np.random.seed(42)

# æ‰€æœ‰å›¾è¡¨æ•°æ®éƒ½åŸºäºè¿™ä¸ªå›ºå®šæ—¥æœŸèŒƒå›´
df_sample = pd.DataFrame({
    'date': dates,
    'vulnerability_index': vulnerability_index,
    'market_leverage': 0.8 + 0.3 * vulnerability_index + np.random.normal(0, 0.05, len(dates)),
    'money_supply_ratio': 3.5 + 0.2 * vulnerability_index + np.random.normal(0, 0.1, len(dates))
})
```

**å›¾è¡¨æ¸²æŸ“** (ç¬¬204-291è¡Œ)
```python
# ä¸‰ä¸ªå›¾è¡¨éƒ½ä½¿ç”¨åŒä¸€ä¸ªdf_sample
# å›¾è¡¨1: Vulnerability Index
fig = px.line(df_sample, x='date', y='vulnerability_index', ...)

# å›¾è¡¨2: Market Leverage Ratio
fig_leverage = px.line(df_sample, x='date', y='market_leverage', ...)

# å›¾è¡¨3: Money Supply Ratio
fig_money = px.line(df_sample, x='date', y='money_supply_ratio', ...)
```

### 2. æ•°æ®æµé—®é¢˜åˆ†æ

```
å½“å‰æµç¨‹:
ç”¨æˆ·é€‰æ‹©æ—¥æœŸ â†’ date_rangeå˜é‡æ›´æ–° â†’ [æœªä½¿ç”¨] â†’ ç¡¬ç¼–ç æ•°æ®ç”Ÿæˆ â†’ å›¾è¡¨æ¸²æŸ“

ç›®æ ‡æµç¨‹:
ç”¨æˆ·é€‰æ‹©æ—¥æœŸ â†’ date_rangeå˜é‡æ›´æ–° â†’ æ•°æ®è¿‡æ»¤/é‡æ–°ç”Ÿæˆ â†’ å›¾è¡¨æ›´æ–°
```

**å…³é”®é—®é¢˜**: `date_range`å˜é‡è¢«å®šä¹‰ä½†ä»æœªè¢«è¯»å–æˆ–ä½¿ç”¨ï¼

### 3. å½±å“èŒƒå›´

å—å½±å“çš„å›¾è¡¨:
1. **ğŸ“Š Vulnerability Index Trend** - ä¸»å›¾è¡¨ (ç¬¬204è¡Œ)
2. **ğŸ“ˆ Market Leverage Ratio** - Part1æŒ‡æ ‡ (ç¬¬271è¡Œ)
3. **ğŸ’° Money Supply Ratio** - Part1æŒ‡æ ‡ (ç¬¬283è¡Œ)

**å…¶ä»–æœªä½¿ç”¨çš„æ§ä»¶**:
- `chart_type` (ç¬¬122-125è¡Œ) - å›¾è¡¨ç±»å‹é€‰æ‹©æ— æ•ˆ
- `show_annotations` (ç¬¬127è¡Œ) - æ³¨é‡Šæ˜¾ç¤ºé€‰é¡¹æ— æ•ˆ

### 4. ç”¨æˆ·ä½“éªŒå½±å“

**å½“å‰ä½“éªŒ**:
- âŒ ç”¨æˆ·è°ƒæ•´æ—¥æœŸèŒƒå›´ â†’ å›¾è¡¨æ— ååº”
- âŒ ç”¨æˆ·é€‰æ‹©ä¸åŒå›¾è¡¨ç±»å‹ â†’ æ— æ•ˆæœ
- âŒ ç”¨æˆ·å¼€å…³æ³¨é‡Š â†’ æ— å˜åŒ–
- âŒ ç”¨æˆ·æ„Ÿè§‰ç³»ç»Ÿ"å¡ä½"æˆ–"æ•…éšœ"

**æœŸæœ›ä½“éªŒ**:
- âœ… è°ƒæ•´æ—¥æœŸèŒƒå›´ â†’ å›¾è¡¨ç«‹å³æ›´æ–°åˆ°é€‰å®šèŒƒå›´
- âœ… é€‰æ‹©å›¾è¡¨ç±»å‹ â†’ å›¾è¡¨æ ·å¼ç›¸åº”æ”¹å˜
- âœ… å¼€å…³æ³¨é‡Š â†’ å›¾è¡¨æ ‡æ³¨æ˜¾ç¤º/éšè—
- âœ… æµç•…çš„äº¤äº’ä½“éªŒ

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: å¿«é€Ÿä¿®å¤ (æ¨è)

**æ ¸å¿ƒæ€è·¯**: ä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„`date_range`æ¥è¿‡æ»¤æ¨¡æ‹Ÿæ•°æ®

```python
# åœ¨æ•°æ®ç”Ÿæˆéƒ¨åˆ†æ·»åŠ æ—¥æœŸè¿‡æ»¤
# ========================================
# å¤„ç†æ—¥æœŸèŒƒå›´é€‰æ‹©
# ========================================
if isinstance(date_range, tuple) and len(date_range) == 2:
    start_date, end_date = date_range
else:
    start_date, end_date = date_range[0], date_range[1]

# ç”Ÿæˆå®Œæ•´æ•°æ®æ± 
all_dates = pd.date_range(start='2020-01-01', end='2025-11-12', freq='M')
# ... ä¿æŒç°æœ‰æ•°æ®ç”Ÿæˆé€»è¾‘ ...

# æ ¹æ®ç”¨æˆ·é€‰æ‹©è¿‡æ»¤æ•°æ®
mask = (df_sample['date'] >= pd.to_datetime(start_date)) & \
       (df_sample['date'] <= pd.to_datetime(end_date))
df_filtered = df_sample[mask].copy()

# ä½¿ç”¨è¿‡æ»¤åçš„æ•°æ®åˆ›å»ºå›¾è¡¨
fig = px.line(df_filtered, x='date', y='vulnerability_index', ...)
```

### æ–¹æ¡ˆ2: å®Œæ•´äº¤äº’åŠŸèƒ½

**å¢å¼ºåŠŸèƒ½**:
```python
# æ·»åŠ å®æ—¶æ•°æ®è¿‡æ»¤å’Œäº¤äº’æ§åˆ¶

# 1. å“åº”date_rangeå˜åŒ–
if date_range:
    start_date, end_date = date_range

    # 2. å“åº”chart_typeå˜åŒ–
    if chart_type == "Candlestick":
        fig_type = go.Candlestick
    elif chart_type == "Area Chart":
        fig_type = px.area
    else:
        fig_type = px.line

    # 3. å“åº”show_annotationså˜åŒ–
    if not show_annotations:
        fig.update_layout(showlegend=False, annotations=[])
```

### æ–¹æ¡ˆ3: æ•°æ®é©±åŠ¨é›†æˆ

**ç»“åˆçœŸå®æ•°æ®**:
```python
# ä½¿ç”¨MarginDebtCalculatorçš„çœŸå®æ•°æ®
try:
    calculator = MarginDebtCalculator()
    market_data = data_fetcher.fetch_complete_market_dataset(
        start_date=start_date.strftime('%Y-%m-%d'),
        end_date=end_date.strftime('%Y-%m-%d')
    )
    results = calculator.calculate_all_indicators(market_data)
    df_real = results['part1_data']

    # ä½¿ç”¨çœŸå®æ•°æ® + æ—¥æœŸè¿‡æ»¤
    df_display = filter_data_by_date(df_real, start_date, end_date)
except:
    # Fallback to demo data
    df_display = filter_demo_data_by_date(start_date, end_date)
```

## ğŸ“Š ä¿®å¤ä¼˜å…ˆçº§

### P0 - ç«‹å³ä¿®å¤ (åŸºæœ¬äº¤äº’)
- [ ] **ä½¿ç”¨date_rangeè¿‡æ»¤å›¾è¡¨æ•°æ®**
- [ ] **ç¡®ä¿ä¸‰ä¸ªPart1å›¾è¡¨éƒ½èƒ½å“åº”æ—¥æœŸå˜æ›´**
- [ ] **æ·»åŠ æ•°æ®èŒƒå›´éªŒè¯**

### P1 - çŸ­æœŸæ”¹è¿› (å®Œæ•´äº¤äº’)
- [ ] å®ç°chart_typeåˆ‡æ¢åŠŸèƒ½
- [ ] å®ç°show_annotationså¼€å…³
- [ ] æ·»åŠ æ•°æ®ç»Ÿè®¡ä¿¡æ¯ (é€‰æ‹©èŒƒå›´å†…çš„è®°å½•æ•°)
- [ ] æ·»åŠ æ—¥æœŸèŒƒå›´æç¤ºæ–‡æœ¬

### P2 - ä¸­æœŸä¼˜åŒ– (æ€§èƒ½ä¸ä½“éªŒ)
- [ ] æ·»åŠ æ•°æ®åŠ è½½çŠ¶æ€æŒ‡ç¤º
- [ ] ä¼˜åŒ–å¤§æ•°æ®é›†æ€§èƒ½
- [ ] æ·»åŠ æ—¥æœŸå¿«æ·é€‰æ‹© (1å¹´ã€5å¹´ã€å…¨éƒ¨ç­‰)
- [ ] æ·»åŠ å›¾è¡¨å¯¼å‡ºåŠŸèƒ½

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•
1. **æ—¥æœŸèŒƒå›´æµ‹è¯•**
   ```python
   # æµ‹è¯•ç”¨ä¾‹
   test_cases = [
       ((datetime(2020, 1, 1), datetime(2023, 12, 31)), "2020-2023"),
       ((datetime(2022, 1, 1), datetime.now()), "2022-present"),
       ((datetime(1997, 1, 1), datetime(2000, 12, 31)), "1997-2000")
   ]
   ```

2. **è¾¹ç•Œæ¡ä»¶æµ‹è¯•**
   - é€‰æ‹©å•ä¸ªæ—¥æœŸ
   - é€‰æ‹©æœªæ¥æ—¥æœŸ
   - é€‰æ‹©è¶…å‡ºæ•°æ®èŒƒå›´çš„æ—¥æœŸ
   - å¿«é€Ÿè¿ç»­åˆ‡æ¢æ—¥æœŸèŒƒå›´

### é›†æˆæµ‹è¯•
1. **UIäº¤äº’æµ‹è¯•**
   - æ»‘å—æ‹–æ‹½å“åº”é€Ÿåº¦
   - æ—¥æœŸé€‰æ‹©å™¨ç²¾åº¦
   - å›¾è¡¨é‡ç»˜æ€§èƒ½

2. **æ•°æ®å®Œæ•´æ€§æµ‹è¯•**
   - è¿‡æ»¤åæ•°æ®ç‚¹æ•°é‡éªŒè¯
   - æ—¥æœŸè¿ç»­æ€§éªŒè¯
   - æ•°å€¼èŒƒå›´åˆç†æ€§æ£€æŸ¥

### ç”¨æˆ·éªŒæ”¶æµ‹è¯•
- [ ] ç”¨æˆ·å¯ä»¥è½»æ¾é€‰æ‹©ä»»æ„æ—¥æœŸèŒƒå›´
- [ ] å›¾è¡¨ç«‹å³å“åº”æ—¥æœŸå˜åŒ– (æ— æ˜æ˜¾å»¶è¿Ÿ)
- [ ] æ—¥æœŸèŒƒå›´å¤–çš„å†å²å±æœºæ ‡æ³¨æ­£ç¡®æ˜¾ç¤º
- [ ] åœ¨ä¸åŒæ ‡ç­¾é¡µé—´åˆ‡æ¢æ—¶æ—¥æœŸé€‰æ‹©ä¿æŒ

## ğŸ“ˆ ä¿®å¤åé¢„æœŸæ•ˆæœ

### ç”¨æˆ·ä½“éªŒæ”¹è¿›
- âœ… **ç›´è§‚çš„äº¤äº’**: è°ƒæ•´æ—¥æœŸèŒƒå›´ â†’ ç«‹å³çœ‹åˆ°å˜åŒ–
- âœ… **æ•°æ®æ¢ç´¢**: å¯ä»¥æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ•°æ®ç»†èŠ‚
- âœ… **å¯¹æ¯”åˆ†æ**: è½»æ¾æ¯”è¾ƒä¸åŒæ—¶æœŸçš„å¸‚åœºçŠ¶å†µ
- âœ… **ä¸“ä¸šæ„Ÿ**: äº¤äº’æµç•…ï¼ŒåŠŸèƒ½å®Œæ•´

### åŠŸèƒ½å®Œå–„åº¦
- **Part1å›¾è¡¨**: çœŸæ­£å“åº”ç”¨æˆ·è¾“å…¥çš„æ—¥æœŸèŒƒå›´
- **æ•°æ®é©±åŠ¨**: ä»é™æ€å±•ç¤ºå˜ä¸ºåŠ¨æ€äº¤äº’
- **ç³»ç»Ÿå®Œæ•´æ€§**: æ‰€æœ‰UIæ§ä»¶éƒ½æœ‰å®é™…åŠŸèƒ½

## ğŸ”— ç›¸å…³é—®é¢˜

æ­¤é—®é¢˜ä¸ä¹‹å‰åˆ†æçš„ [Part1 UI Integration Analysis](PART1_UI_INTEGRATION_ANALYSIS.md) ç›¸å…³ï¼š
- **å…±åŒç‚¹**: éƒ½æ¶‰åŠæ¨¡æ‹Ÿæ•°æ® vs çœŸå®æ•°æ®çš„å±•ç¤º
- **å…³ç³»**: ä¿®å¤æ—¥æœŸèŒƒå›´é—®é¢˜æ˜¯ä¸ºé›†æˆçœŸå®æ•°æ®çš„å‡†å¤‡æ­¥éª¤
- **ä¼˜å…ˆçº§**: æ—¥æœŸèŒƒå›´äº¤äº’é—®é¢˜æ›´å®¹æ˜“ä¿®å¤ï¼Œå»ºè®®ä½œä¸ºç¬¬ä¸€æ­¥

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### StreamlitçŠ¶æ€ç®¡ç†
```python
# å…³é”®æ¦‚å¿µ:
# 1. st.date_input() è¿”å›ç”¨æˆ·é€‰æ‹©çš„å€¼
# 2. è¿™ä¸ªå€¼éœ€è¦æ˜¾å¼ä¼ é€’ç»™ä¸‹æ¸¸é€»è¾‘
# 3. Streamlitä¼šåœ¨æ§ä»¶å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è¿è¡Œè„šæœ¬
# 4. ä½†å¦‚æœä¸ç”¨å˜é‡å­˜å‚¨ç»“æœï¼Œå˜åŒ–å°±æ— æ„ä¹‰

# æ­£ç¡®åšæ³•:
date_range = st.date_input(...)  # âœ… å­˜å‚¨ç»“æœ
filtered_data = filter_by_date(date_range)  # âœ… ä½¿ç”¨ç»“æœ

# é”™è¯¯åšæ³•:
st.date_input(...)  # âŒ ä¸å­˜å‚¨ç»“æœ
# åé¢ä½¿ç”¨ç¡¬ç¼–ç æ•°æ®  # âŒ ä¸ä½¿ç”¨é€‰æ‹©
```

### æ•°æ®è¿‡æ»¤æœ€ä½³å®è·µ
```python
# å»ºè®®çš„æ•°æ®è¿‡æ»¤æ¨¡å¼
def filter_dataframe_by_date(df, date_col, start_date, end_date):
    """æ ¹æ®æ—¥æœŸèŒƒå›´è¿‡æ»¤DataFrame"""
    mask = (df[date_col] >= pd.to_datetime(start_date)) & \
           (df[date_col] <= pd.to_datetime(end_date))
    return df[mask]

# åœ¨Streamlitä¸­è°ƒç”¨
df_filtered = filter_dataframe_by_date(
    df_sample,
    'date',
    start_date,
    end_date
)
```

## ğŸ¯ å®æ–½å»ºè®®

1. **ç«‹å³å®æ–½**: æ–¹æ¡ˆ1 - å¿«é€Ÿä¿®å¤åŸºæœ¬æ—¥æœŸèŒƒå›´è¿‡æ»¤
2. **æµ‹è¯•éªŒè¯**: ä½¿ç”¨æ‰‹åŠ¨æµ‹è¯•å’Œè‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯ä¿®å¤
3. **ç”¨æˆ·åé¦ˆ**: æ”¶é›†ç”¨æˆ·å¯¹æ–°äº¤äº’çš„åé¦ˆ
4. **é€æ­¥å®Œå–„**: å®æ–½æ–¹æ¡ˆ2å’Œæ–¹æ¡ˆ3çš„å¢å¼ºåŠŸèƒ½

---

**åˆ†æå®Œæˆæ—¶é—´**: 2025-11-14
**é—®é¢˜çŠ¶æ€**: ğŸ”´ å·²è¯†åˆ«
**ä¿®å¤éš¾åº¦**: ğŸŸ¢ ç®€å• (1-2å°æ—¶)
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜ (å½±å“æ ¸å¿ƒç”¨æˆ·ä½“éªŒ)
