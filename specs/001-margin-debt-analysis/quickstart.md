# å¿«é€Ÿå¼€å§‹æŒ‡å—: èèµ„ä½™é¢å¸‚åœºåˆ†æç³»ç»Ÿ

**ç‰ˆæœ¬**: 1.0.0
**æ—¥æœŸ**: 2025-11-08
**åˆ†æ”¯**: 001-margin-debt-analysis

## æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œèèµ„ä½™é¢å¸‚åœºåˆ†æç³»ç»Ÿã€‚ç³»ç»ŸåŸºäºPythonå¼€å‘ï¼Œä½¿ç”¨Streamlitä½œä¸ºWebæ¡†æ¶ï¼ŒPlotlyè¿›è¡Œäº¤äº’å¼å¯è§†åŒ–ã€‚

---

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux / macOS / Windows
- **Pythonç‰ˆæœ¬**: 3.11 æˆ–æ›´é«˜
- **å†…å­˜**: æœ€å°‘ 4GB RAM (æ¨è 8GB+)
- **ç£ç›˜ç©ºé—´**: æœ€å°‘ 2GB å¯ç”¨ç©ºé—´
- **æµè§ˆå™¨**: Chrome 90+ / Firefox 88+ / Safari 14+

---

## ğŸš€ å®‰è£…æ­¥éª¤

### 1. å…‹éš†ä»“åº“

```bash
git clone <repository-url>
cd levAnalyzeMM
```

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

**Linux / macOS:**
```bash
python3 -m venv venv
source venv/bin/activate
```

**Windows:**
```bash
python -m venv venv
venv\Scripts\activate
```

### 3. å®‰è£…ä¾èµ–

```bash
# å‡çº§pip
pip install --upgrade pip

# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt
```

**æ ¸å¿ƒä¾èµ–åˆ—è¡¨** (requirements.txt):
```
streamlit>=1.28.0
pandas>=2.0.0
plotly>=5.17.0
numpy>=1.24.0
yfinance>=0.2.18
fredapi>=0.5.0
python-dateutil>=2.8.0
```

### 4. éªŒè¯å®‰è£…

```bash
# éªŒè¯Pythonç‰ˆæœ¬
python --version

# éªŒè¯å…³é”®ä¾èµ–
python -c "import streamlit; print('Streamlitç‰ˆæœ¬:', streamlit.__version__)"
python -c "import pandas; print('Pandasç‰ˆæœ¬:', pandas.__version__)"
python -c "import plotly; print('Plotlyç‰ˆæœ¬:', plotly.__version__)"
```

---

## ğŸ“ æ•°æ®å‡†å¤‡

### 1. å‡†å¤‡FINRAæ•°æ®

```bash
# æ£€æŸ¥FINRAæ•°æ®æ–‡ä»¶
ls -la datas/margin-statistics.csv

# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·è”ç³»æ•°æ®ç®¡ç†å‘˜è·å–
```

### 2. éªŒè¯æ•°æ®æ ¼å¼

```python
# åˆ›å»ºéªŒè¯è„šæœ¬
cat > verify_data.py << 'EOF'
import pandas as pd

try:
    df = pd.read_csv('datas/margin-statistics.csv')
    print(f"âœ… FINRAæ•°æ®åŠ è½½æˆåŠŸ")
    print(f"   æ•°æ®è¡Œæ•°: {len(df)}")
    print(f"   åˆ—å: {list(df.columns)}")
    print(f"   æ—¥æœŸèŒƒå›´: {df['date'].min()} åˆ° {df['date'].max()}")
    print(f"   ç¼ºå¤±å€¼: {df.isnull().sum().sum()}")
except Exception as e:
    print(f"âŒ æ•°æ®éªŒè¯å¤±è´¥: {e}")
EOF

# è¿è¡ŒéªŒè¯
python verify_data.py
```

**é¢„æœŸè¾“å‡º**:
```
âœ… FINRAæ•°æ®åŠ è½½æˆåŠŸ
   æ•°æ®è¡Œæ•°: 345
   åˆ—å: ['date', 'margin_debt']
   æ—¥æœŸèŒƒå›´: 1997-01 åˆ° 2025-09
   ç¼ºå¤±å€¼: 0
```

### 3. æ•°æ®æ–‡ä»¶ç»“æ„

**datas/margin-statistics.csv**:
```csv
date,margin_debt
1997-01-31,0.123
1997-02-28,0.127
...
2025-09-30,0.987
```

---

## ğŸ¯ è¿è¡Œåº”ç”¨

### 1. å¯åŠ¨Streamlitåº”ç”¨

```bash
# ä»é¡¹ç›®æ ¹ç›®å½•å¯åŠ¨
streamlit run app.py
```

### 2. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®: **http://localhost:8501**

### 3. éªŒè¯ç³»ç»Ÿå¯åŠ¨

æˆåŠŸå¯åŠ¨åæ‚¨åº”è¯¥çœ‹åˆ°:

```
âœ… èèµ„ä½™é¢å¸‚åœºåˆ†æç³»ç»Ÿ
ğŸ“Š æ ¸å¿ƒæŒ‡æ ‡ä»ªè¡¨æ¿
ğŸ“ˆ 7ä¸ªæ ¸å¿ƒæŒ‡æ ‡å±•ç¤º
â° æ—¶é—´èŒƒå›´é€‰æ‹©å™¨
ğŸ” å†å²å±æœºæ—¶æœŸé«˜äº®
âš ï¸ é£é™©ä¿¡å·è¯†åˆ«
```

---

## ğŸ“Š ä½¿ç”¨æŒ‡å—

### ä¸»è¦åŠŸèƒ½

#### 1. æŸ¥çœ‹æ ¸å¿ƒæŒ‡æ ‡ä»ªè¡¨æ¿

- **ä½ç½®**: ä¸»é¡µ
- **å†…å®¹**: 7ä¸ªæ ¸å¿ƒæŒ‡æ ‡çš„å¯è§†åŒ–å›¾è¡¨
- **æ“ä½œ**:
  - é¼ æ ‡æ‚¬åœæŸ¥çœ‹è¯¦ç»†æ•°æ®
  - ç‚¹å‡»å›¾ä¾‹éšè—/æ˜¾ç¤ºæŒ‡æ ‡
  - ä½¿ç”¨å·¥å…·æ ç¼©æ”¾å’Œå¹³ç§»

#### 2. è„†å¼±æ€§æŒ‡æ•°åˆ†æ â­

- **ä½ç½®**: ä»ªè¡¨æ¿ä¸­å¤®
- **å†…å®¹**: æ æ†Zåˆ†æ•° - VIX Zåˆ†æ•°çš„æ—¶é—´åºåˆ—
- **é¢œè‰²ç¼–ç **:
  - ğŸŸ¢ ç»¿è‰²: ä½é£é™© (è„†å¼±æ€§æŒ‡æ•° < 0)
  - ğŸŸ¡ é»„è‰²: ä¸­é£é™© (0 â‰¤ æŒ‡æ•° < 1)
  - ğŸŸ  æ©™è‰²: é«˜é£é™© (1 â‰¤ æŒ‡æ•° < 2)
  - ğŸ”´ çº¢è‰²: æé«˜é£é™© (æŒ‡æ•° â‰¥ 2)

#### 3. å†å²å±æœºæ—¶æœŸå¯¹æ¯”

- **ä½ç½®**: é¡µé¢é¡¶éƒ¨æ§åˆ¶é¢æ¿
- **æ“ä½œ**:
  1. ç‚¹å‡»"å†å²å±æœº"æ ‡ç­¾
  2. é€‰æ‹©è¦æ˜¾ç¤ºçš„å±æœºæ—¶æœŸ:
     - äº’è”ç½‘æ³¡æ²« (2000-2002)
     - é‡‘èå±æœº (2007-2009)
     - ç–«æƒ…å†²å‡» (2020-2022)
     - é«˜é€šèƒ€ (2021-2022)
  3. å›¾è¡¨ä»¥é˜´å½±åŒºåŸŸé«˜äº®æ˜¾ç¤ºé€‰ä¸­çš„æ—¶æœŸ

#### 4. æ—¶é—´èŒƒå›´é€‰æ‹©

- **ä½ç½®**: ä¾§è¾¹æ 
- **åŠŸèƒ½**:
  - æ»‘å—é€‰æ‹©æ—¶é—´èŒƒå›´
  - é¢„è®¾æŒ‰é’® (1å¹´ã€5å¹´ã€å…¨éƒ¨)
  - æ‰€æœ‰å›¾è¡¨åŒæ­¥æ›´æ–°

#### 5. æŠ•èµ„æ´å¯Ÿé¢æ¿

- **ä½ç½®**: é¡µé¢ä¸‹æ–¹
- **å†…å®¹**:
  - å½“å‰é£é™©ç­‰çº§
  - å¸‚åœºçŠ¶æ€è¯„ä¼°
  - æŠ•èµ„å»ºè®® (çŸ­æœŸ/ä¸­æœŸ/é•¿æœŸ)
  - å…³é”®é£é™©ä¿¡å·

### å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `Ctrl + /` | æ˜¾ç¤ºå¿«æ·é”®å¸®åŠ© |
| `F11` | å…¨å±æ¨¡å¼ |
| `Ctrl + S` | ä¸‹è½½å½“å‰å›¾è¡¨ |
| `R` | é‡ç½®ç¼©æ”¾ |
| `Shift + ?` | æ˜¾ç¤ºé«˜çº§é€‰é¡¹ |

---

## âš™ï¸ é…ç½®é€‰é¡¹

### é…ç½®æ–‡ä»¶

ç¼–è¾‘ `config.py` è‡ªå®šä¹‰ç³»ç»Ÿè®¾ç½®:

```python
# config.py

# æ•°æ®æºé…ç½®
DATA_CONFIG = {
    'start_date': '1997-01-01',
    'end_date': '2025-09-30',
    'cache_enabled': True,
    'cache_ttl_hours': 24
}

# è„†å¼±æ€§æŒ‡æ•°é…ç½®
VULNERABILITY_CONFIG = {
    'zscore_window': 252,  # 12ä¸ªæœˆ
    'risk_thresholds': {
        'low': -1.0,
        'medium': 0.0,
        'high': 1.0,
        'extreme': 2.0
    }
}

# å¯è§†åŒ–é…ç½®
VIZ_CONFIG = {
    'theme': 'plotly_white',
    'default_height': 600,
    'show_confidence_bands': True
}
```

### ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶:

```bash
# .env
FRED_API_KEY=your_fred_api_key_here
CACHE_ENABLED=true
DEBUG_MODE=false
```

---

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. è‡ªå®šä¹‰æ—¶é—´èŒƒå›´

```python
# åœ¨app.pyä¸­
import streamlit as st

# ä¾§è¾¹æ æ—¶é—´é€‰æ‹©
st.sidebar.header("æ—¶é—´èŒƒå›´æ§åˆ¶")
date_range = st.sidebar.slider(
    "é€‰æ‹©æ—¶é—´èŒƒå›´",
    min_value=pd.to_datetime('1997-01-01'),
    max_value=pd.to_datetime('2025-09-30'),
    value=(pd.to_datetime('2010-01-01'), pd.to_datetime('2025-09-30'))
)
```

### 2. å¯¼å‡ºæ•°æ®

```python
# åœ¨Streamlitåº”ç”¨ä¸­é€‰æ‹©å¯¼å‡ºæ ¼å¼
export_format = st.sidebar.selectbox(
    "é€‰æ‹©å¯¼å‡ºæ ¼å¼",
    ["CSV", "Excel", "JSON"]
)

# ç‚¹å‡»å¯¼å‡ºæŒ‰é’®
if st.sidebar.button("å¯¼å‡ºå½“å‰æ•°æ®"):
    if export_format == "CSV":
        df.to_csv("market_analysis.csv", index=False)
    elif export_format == "Excel":
        df.to_excel("market_analysis.xlsx", index=False)
    st.sidebar.success("æ•°æ®å¯¼å‡ºæˆåŠŸï¼")
```

### 3. å®æ—¶æ•°æ®æ›´æ–°

```python
# è®¾ç½®è‡ªåŠ¨åˆ·æ–°
st.sidebar.checkbox("å¯ç”¨å®æ—¶æ•°æ®æ›´æ–°", value=False)

if st.sidebar.checkbox:
    # æ¯60ç§’åˆ·æ–°ä¸€æ¬¡
    st.experimental_rerun()
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å¯ç”¨ç¼“å­˜

ç³»ç»Ÿé»˜è®¤å¯ç”¨Streamlitç¼“å­˜ï¼Œç¼“å­˜æ•°æ®24å°æ—¶ã€‚

```python
# æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜
st.sidebar.button("æ¸…é™¤æ‰€æœ‰ç¼“å­˜")
```

### 2. æ•°æ®åˆ†å—åŠ è½½

å¯¹äºå¤§æ•°æ®é›†ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ†å—åŠ è½½ã€‚

```python
# åœ¨æºä»£ç ä¸­ (src/data/fetcher.py)
@st.cache_data(ttl=3600)
def load_market_data():
    # åŠ è½½æ•°æ®
    return df
```

### 3. æ€§èƒ½ç›‘æ§

```python
# åœ¨Streamlitä¸­æ˜¾ç¤ºæ€§èƒ½æŒ‡æ ‡
st.sidebar.metric("æ•°æ®ç‚¹æ•°é‡", f"{len(df):,}")
st.sidebar.metric("åŠ è½½æ—¶é—´", f"{load_time:.2f}ç§’")
st.sidebar.metric("å†…å­˜ä½¿ç”¨", f"{memory_usage:.1f}MB")
```

---

## ğŸ§ª æµ‹è¯•

### 1. è¿è¡Œå•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_vulnerability_index.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=src --cov-report=html
```

### 2. æ‰‹åŠ¨æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] åº”ç”¨æ­£å¸¸å¯åŠ¨ (http://localhost:8501)
- [ ] æ•°æ®åŠ è½½æˆåŠŸ (æ— é”™è¯¯ä¿¡æ¯)
- [ ] 7ä¸ªæ ¸å¿ƒæŒ‡æ ‡å›¾è¡¨æ˜¾ç¤º
- [ ] è„†å¼±æ€§æŒ‡æ•°å›¾è¡¨çªå‡ºæ˜¾ç¤º â­
- [ ] æ—¶é—´èŒƒå›´é€‰æ‹©å™¨å·¥ä½œæ­£å¸¸
- [ ] å†å²å±æœºæ—¶æœŸé«˜äº®æ˜¾ç¤º
- [ ] æ‚¬åœä¿¡æ¯æ˜¾ç¤ºè¯¦ç»†æ•°æ®
- [ ] ç¼©æ”¾å’Œå¹³ç§»åŠŸèƒ½æ­£å¸¸
- [ ] é£é™©ç­‰çº§é¢œè‰²æ­£ç¡®
- [ ] æŠ•èµ„æ´å¯Ÿé¢æ¿æ˜¾ç¤º
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½æ­£å¸¸

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: å¯åŠ¨å¤±è´¥ - "Port 8501 already in use"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä½¿ç”¨ä¸åŒç«¯å£
streamlit run app.py --server.port 8502

# æˆ–è€…ç»ˆæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -ti:8501 | xargs kill -9
```

### Q2: æ•°æ®åŠ è½½é”™è¯¯ - "FileNotFoundError: datas/margin-statistics.csv"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la datas/

# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä»æ•°æ®æºè·å–
python scripts/download_finra_data.py

# æˆ–æ‰‹åŠ¨æ”¾ç½®æ–‡ä»¶åˆ°datasç›®å½•
```

### Q3: APIè°ƒç”¨å¤±è´¥ - "Rate limit exceeded"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å¯ç”¨ç¼“å­˜ (æ¨è)
echo "CACHE_ENABLED=true" >> .env

# æˆ–ä½¿ç”¨ç¦»çº¿æ¨¡å¼
echo "OFFLINE_MODE=true" >> .env
```

### Q4: å›¾è¡¨æ˜¾ç¤ºå¼‚å¸¸ - "JavaScript error"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# æˆ–å°è¯•æ— ç—•/éšç§æ¨¡å¼

# å‡çº§plotly
pip install --upgrade plotly
```

### Q5: å†…å­˜ä¸è¶³ - "MemoryError"

**è§£å†³æ–¹æ¡ˆ**:
```python
# å‡å°‘æ•°æ®èŒƒå›´
# åœ¨config.pyä¸­è®¾ç½®
DATA_CONFIG = {
    'start_date': '2020-01-01',  # ç¼©å°èŒƒå›´
    'end_date': '2025-09-30'
}
```

### Q6: è„†å¼±æ€§æŒ‡æ•°è®¡ç®—é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```python
# æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
python -c "
import pandas as pd
df = pd.read_csv('datas/complete_market_analysis_monthly.csv')
print('ç¼ºå¤±å€¼:', df[['margin_debt', 'vix_index']].isnull().sum())
print('å¼‚å¸¸å€¼:', df[(df['margin_debt'] < 0) | (df['vix_index'] < 0)])
"
```

---

## ğŸ“š æ·±å…¥å­¦ä¹ 

### æ ¸å¿ƒç®—æ³•å‚è€ƒ

- **è„†å¼±æ€§æŒ‡æ•°ç®—æ³•**: `docs/sig_Bubbles.md`
- **æ•°æ®æ¨¡å‹è¯¦ç»†è¯´æ˜**: `data-model.md`
- **APIåˆåŒ**: `contracts/` ç›®å½•

### èµ„æºé“¾æ¥

- [Streamlitå®˜æ–¹æ–‡æ¡£](https://docs.streamlit.io/)
- [Plotlyç”¨æˆ·æŒ‡å—](https://plotly.com/python/)
- [Pandasæ—¶é—´åºåˆ—](https://pandas.pydata.org/docs/user_guide/timeseries.html)
- [FRED APIæ–‡æ¡£](https://fred.stlouisfed.org/docs/api/)

### å­¦ä¹ è·¯å¾„

1. **åŸºç¡€** (ç¬¬1å¤©):
   - è¿è¡Œåº”ç”¨ï¼Œç†Ÿæ‚‰ç•Œé¢
   - äº†è§£7ä¸ªæ ¸å¿ƒæŒ‡æ ‡
   - æŒæ¡æ—¶é—´èŒƒå›´é€‰æ‹©

2. **è¿›é˜¶** (ç¬¬2-3å¤©):
   - ç†è§£è„†å¼±æ€§æŒ‡æ•°åŸç†
   - åˆ†æå†å²å±æœºæ—¶æœŸ
   - è§£è¯»æŠ•èµ„æ´å¯Ÿ

3. **é«˜çº§** (ç¬¬4-5å¤©):
   - æŸ¥çœ‹æºä»£ç ç»“æ„
   - ä¿®æ”¹é…ç½®å‚æ•°
   - å¯¼å‡ºæ•°æ®åˆ†æ

---

## ğŸ†˜ è·å–å¸®åŠ©

### æ”¯æŒæ¸ é“

- **æ–‡æ¡£**: æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£å’Œæ³¨é‡Š
- **GitHub Issues**: æäº¤bugæŠ¥å‘Šå’ŒåŠŸèƒ½è¯·æ±‚
- **è®¨è®ºåŒº**: å‚ä¸ç¤¾åŒºè®¨è®º
- **é‚®ä»¶**: æŠ€æœ¯æ”¯æŒ (support@example.com)

### åé¦ˆä¿¡æ¯

é‡åˆ°é—®é¢˜æ—¶ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯:

```bash
# ç³»ç»Ÿä¿¡æ¯
python -c "import sys, platform; print(f'Python: {sys.version}'); print(f'Platform: {platform.platform()}')"

# ä¾èµ–ç‰ˆæœ¬
pip freeze | grep -E "streamlit|pandas|plotly"

# é”™è¯¯æ—¥å¿—
streamlit run app.py --logger.level=debug
```

---

## ğŸ‰ å®Œæˆï¼

æ­å–œï¼æ‚¨å·²ç»æˆåŠŸå®‰è£…å’Œé…ç½®äº†èèµ„ä½™é¢å¸‚åœºåˆ†æç³»ç»Ÿã€‚

### ä¸‹ä¸€æ­¥

- âœ… ç†Ÿæ‚‰ç³»ç»Ÿç•Œé¢å’ŒåŠŸèƒ½
- âœ… åˆ†æå½“å‰å¸‚åœºè„†å¼±æ€§æŒ‡æ•°
- âœ… å¯¹æ¯”å†å²å±æœºæ—¶æœŸ
- âœ… è§£è¯»æŠ•èµ„æ´å¯Ÿå’Œé£é™©ä¿¡å·

### è¿›é˜¶å­¦ä¹ 

- ğŸ“– é˜…è¯» `docs/sig_Bubbles.md` äº†è§£ç®—æ³•ç»†èŠ‚
- ğŸ” æŸ¥çœ‹ `data-model.md` ç†è§£æ•°æ®æ¨¡å‹
- ğŸ’» æµè§ˆ `contracts/` ç›®å½•å­¦ä¹ APIè®¾è®¡
- ğŸ§ª è¿è¡Œæµ‹è¯•éªŒè¯ç³»ç»ŸåŠŸèƒ½

---

**å¿«é€Ÿå¼€å§‹ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2025-11-08
**çŠ¶æ€**: âœ… éªŒè¯é€šè¿‡
